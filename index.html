<html>
<head>
<title>Morse Code</title>
<meta charset="utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/psi.ico" />
<link rel="stylesheet" type="text/css" href="/jquery.ui.css" />
<link rel="stylesheet" type="text/css" href="icons.css" />
<link rel="stylesheet" type="text/css" href="/fonts.css" />
<script>
var log = console.log.bind(console)
</script>
<script src="/jquery.js"></script>
<script src="/jquery.ui.js"></script>
<script src="treant/vendor/raphael.js"></script>
<script src="treant/treant.js"></script>
<script src="combinatorics.js"></script>
<link rel="stylesheet" type="text/css" href="treant/treant.css" />
<link rel="stylesheet" type="text/css" href="morse.css" />
<script>
(function($){
	$.fn.shuffle = function() {
		return this.each(function(){
			var items = $(this).find('tr') || $(this).children();
			return (items.length) ? $(this).html($.shuffle(items)) : this;
		});
	}
	$.shuffle = function(arr) {
		for(var j, x, i = arr.length; i; j = parseInt(Math.random() * i), x = arr[--i], arr[i] = arr[j], arr[j] = x);
		return arr;
	}
})(jQuery);

$(function() {


	$("nav div").click(function() {
 		$(".selected").removeClass("selected")
 		$(this).addClass("selected")
 		$('article').hide()
 		$("#" + $(this).attr('page')).show()
 	})
 	$("div[page='3']").click()
	$("div[page='3']").click(function() {
		$('#guess').focus()
	})


	$("#showall").click(function() {
		if ($(this).is(":checked")) {
			$("#1 tr").each(function() {
				if ($(this).find("th").text() == "_") {
					$(this).show()
				}
			})
		}
		else {
			$("#1 tr").each(function() {
				if ($(this).find("th").text() == "_") {
					$(this).hide()
				}
			})
		}
	}).click().click()


 	var encodex = "{", decodex = "{", str, result, i, j
	$("#all tr").each(function() {
		encodex += "\"" + $(this).find("th").html().trim() + "\"" + ": \"" + $(this).find("td").html().trim() + "\","
		decodex += "\"" + $(this).find("td").html().trim() + "\"" + ": \"" + $(this).find("th").html().trim() + "\","
	})
	encodex = encodex.substring(0, encodex.length-1)
	decodex = decodex.substring(0, decodex.length-1)
	encodex += "}"
	decodex += "}"
	encodex = $.parseJSON(encodex)
	decodex = $.parseJSON(decodex)

	$("#t1").keyup(function() {
		$("#readout tr").html("")
		$(this).val($(this).val().toUpperCase())
		str = $(this).val().split('')
		result = ""

		str.map(function(a, b) {
			if (a == " ") {
				result += " ";
				return
			}
			if (typeof encodex[a] == "undefined") {
				result += "";
				return
			}
			$("#readout tr").append($("#tables").find("th." + a).parent().find("td").clone())
			result += encodex[a] + " "
		})
		$("#t2").val(result)
	})
	$("#t2").keyup(function(e) {
		$("#readout tr").html("")

		str = $(this).val().split(/\s/)
		result = ""
		str.map(function(a, b) {
			if (typeof decodex[a] == "undefined") {
				result += "";
				return
			}
			result += decodex[a]
			$("#readout tr").append($("#tables").find("th." + decodex[a]).parent().find("td").clone())
		})
		$("#t1").val(result)
	})
	$("#t2").keydown(function(e) {
		if ([8, 13, 32, 189, 190].includes(e.which)) {

		}
		else {
			e.preventDefault()
			$(this).val($(this).val().substring(0, $(this).val().length-1))
		}
	})


	$(".play").click(function(e) {
		$("#readout audio").eq(0).get(0).play()
		i = 1
		$("#readout audio").on("ended", function() {
			if (!$("#readout audio").eq(i).get(0)) return
			$("#readout audio").eq(i).get(0).play()
			i++
		})
	})

	j = 0
	$('#shuffle').click(function() {
		$('#all').shuffle()
		$('#guess').keyup().focus()
	}).click()
	$("#flashcard").click(function() {
		$('#guess').removeAttr('disabled')
		$('#guess').focus()
		$("#guess").val("").css("background-color", "rgb(255, 255, 255)")

		$(this).html($("#all").find("th").eq(j).html())

		j++
		if (j >= $("#all").find("th").length) {
			j = 0
		}
		if($(this).html() === '_') {
			$("#flashcard").click()
		}
	})


// $("#guess").keyup(function(e) {

// })



	$("#guess").keydown(function(e) {
		if (![8, 13, 32, 189, 190].includes(e.which)) {
			e.preventDefault()
			$('#guess').focus()
			return
		}
	})
	$("#guess").keyup(function(e) {

		if (e.which === 13 || e.which === 32) {
			if ($(this).css('background-color') === 'rgb(0, 128, 0)') {
				$("#flashcard").click()
				return
			}
			$('#guess').focus()
		}
		var guess = $(this).val(),
			a = $("#flashcard").html(),
			check = decodex[guess],
			b = encodex[a]

		log(guess, a, check, b)

		$(this).css("background-color", "rgb(255, 255, 255)")

		if (guess.length == b.length) {
			if (check == a) {
				$(this).css('background-color', 'rgb(0, 128, 0)')
			}
			else {
				$(this).css('background-color', 'rgb(255, 0, 0)')
			}
		}
	})
	$('#dot').click(function() {
		$('#guess').val($('#guess').val()+'.')
		$('#guess').keyup().focus()
	})
	$('#dash').click(function() {
		$('#guess').val($('#guess').val()+'-')
		$('#guess').keyup().focus()
	})

	simple_chart_config = {
		chart: {
			container: "#codetree",
			rootOrientation: 'WEST',
			hideRootNode: true,
			connectors: {
				type: 'bCurve',
			},
			animation: {
				nodeAnimation: "easeOutBounce",
				nodeSpeed: 700,
				connectorsAnimation: "bounce",
				connectorsSpeed: 700
			},
			// padding: 25,
			levelSeparation:   20,
			siblingSeparation: 0,
			subTreeSeparation: 0
		},
		nodeStructure: {
			text: {name: "start"},
			children: [{
				text: {name: "."},
				children: [{
					text: {name: ".."},
					children: [{
						text: {name: "..."},
						children: [{
							text: {name: "...."},
						},{
							text: {name: "...-"},
						}],
					},{
						text: {name: "..-"},
						children: [{
							text: {name: "..-."},
						},{
							text: {name: "..--"},
						}],
					}]
				},{
					text: {name: "-."},
					children: [{
						text: {name: "-.."},
						children: [{
							text: {name: "-..."},
						},{
							text: {name: "-..-"},
						}],
					},{
						text: {name: "-.-"},
						children: [{
							text: {name: "-.-."},
						},{
							text: {name: "-.--"},
						}],
					}]
				}]
			},{
				text: {name: "-"},
				children: [{
					text: {name: "-."},
					children: [{
						text: {name: "-.."},
						children: [{
							text: {name: "-..."},
						},{
							text: {name: "-..-"},
						}],
					},{
						text: {name: "-.-"},
						children: [{
							text: {name: "--."},
						},{
							text: {name: "---"},
						}],
					}]
				},{
					text: {name: "--"},
					children: [{
						text: {name: "--."},
						children: [{
							text: {name: "--.."},
						},{
							text: {name: "--.-"},
						}],
					},{
						text: {name: "---"},
						children: [{
							text: {name: "---."},
						},{
							text: {name: "----"},
						}],
					}]
				}]
			}]
		}
	};
	var my_chart = new Treant(simple_chart_config);

	function cmb(arr, n) {
		var result = [];
		for(var i = 1; i <= n; i++) {
			result = result.concat(Combinatorics.baseN(arr, i).toArray())
		}
		return result;
	}


	$("a.sound").click(function(e) {
		$(this).next('audio').get(0).play()
	})
	$("table tbody, div").disableSelection()



	$(document).on('mouseenter', '.node', function() {
		$(this).addClass('invert')
		$('a:contains("'+$(this).text()+'")').parents('tr').addClass('invert')
	})
	.on('mouseleave', '.node', function() {
		$(this).removeClass('invert')
		$('.invert').removeClass('invert')
	})


	var cheat = $('#tables').clone()
	cheat.attr('id', 'cheat')
	$('#game').after(cheat)
	$('#cheat').toggle()

	$(document).on('keydown', function(e) {
		if (e.which === 27 && $("div[page='3']").is(':visible')) {
			$('#cheat').toggle()

		}

	})





return

	$("#tables tbody").sortable({
		snap: true,
		helper: "clone",
		handle: "th",
		connectWith: "#tables tbody"
	});
	$(".accept").droppable({
		drop: function(event, ui) {
			$(this).css("background-color", "rgba(0, 255, 0, .5)")
		},
		out: function(event, ui) {
			$(this).css("background-color", "rgba(255, 255, 255, 1)")
		}
	})

	$("th, td").each(function() {
		$(this).data({
			'originalLeft': $(this).css('left'),
			'originalTop': $(this).css('top')
		})
	})

	$("#revert").click(function() {
		$("th, td").each(function() {
			$(this).css({
				'left': $(this).data('originalLeft'),
				'top': $(this).data('originalTop')
			})
		})
	})






	$("#all").shuffleRows()

})

</script>
</head>
<body>

<nav>
<div page='1'>Chart</div>
<div page='2'>Write</div>
<div page='3'>Learn</div>
</nav>



<article id='1'>
<div id='wrapper'>
<input type='checkbox' id='showall' /><label for='showall'>Show All</label>
<!-- <button id="revert">Revert</button> -->

<div id='tables'>
	<table>
	<tbody>
		<tr><th class='T'>T</th><td><a class='sound'>-</a><audio src="ogg/T_morse_code.ogg"></audio></td></tr>
		<tr><th class='E'>E</th><td><a class='sound'>.</a><audio src="ogg/E_morse_code.ogg"></audio></td></tr>
	</tbody>
	</table>
	<table>
	<tbody>
		<tr><th class='M'>M</th><td><a class='sound'>--</a><audio src="ogg/M_morse_code.ogg"></audio></td></tr>
		<tr><th class='N'>N</th><td><a class='sound'>-.</a><audio src="ogg/N_morse_code.ogg"></audio></td></tr>
		<tr><th class='A'>A</th><td><a class='sound'>.-</a><audio src="ogg/A_morse_code.ogg"></audio></td></tr>
		<tr><th class='I'>I</th><td><a class='sound'>..</a><audio src="ogg/I_morse_code.ogg"></audio></td></tr>
	</tbody>
	</table>
	<table>
	<tbody>
		<tr><th class='O'>O</th><td><a class='sound'>---</a><audio src="ogg/O_morse_code.ogg"></audio></td></tr>
		<tr><th class='G'>G</th><td><a class='sound'>--.</a><audio src="ogg/G_morse_code.ogg"></audio></td></tr>
		<tr><th class='K'>K</th><td><a class='sound'>-.-</a><audio src="ogg/K_morse_code.ogg"></audio></td></tr>
		<tr><th class='D'>D</th><td><a class='sound'>-..</a><audio src="ogg/D_morse_code.ogg"></audio></td></tr>
		<tr><th class='W'>W</th><td><a class='sound'>.--</a><audio src="ogg/W_morse_code.ogg"></audio></td></tr>
		<tr><th class='R'>R</th><td><a class='sound'>.-.</a><audio src="ogg/R_morse_code.ogg"></audio></td></tr>
		<tr><th class='U'>U</th><td><a class='sound'>..-</a><audio src="ogg/U_morse_code.ogg"></audio></td></tr>
		<tr><th class='S'>S</th><td><a class='sound'>...</a><audio src="ogg/S_morse_code.ogg"></audio></td></tr>
	</tbody>
	</table>
	<table>
		<tbody>
		<tr><th>_</th><td>----</td></tr>
		<tr><th>_</th><td>---.</td></tr>
		<tr><th class='Q'>Q</th><td><a class='sound'>--.-</a><audio src="ogg/Q_morse_code.ogg"></audio></td></tr>
		<tr><th class='Z'>Z</th><td><a class='sound'>--..</a><audio src="ogg/Z_morse_code.ogg"></audio></td></tr>
		<tr><th class='Y'>Y</th><td><a class='sound'>-.--</a><audio src="ogg/Y_morse_code.ogg"></audio></td></tr>
		<tr><th class='C'>C</th><td><a class='sound'>-.-.</a><audio src="ogg/C_morse_code.ogg"></audio></td></tr>
		<tr><th class='X'>X</th><td><a class='sound'>-..-</a><audio src="ogg/X_morse_code.ogg"></audio></td></tr>
		<tr><th class='B'>B</th><td><a class='sound'>-...</a><audio src="ogg/B_morse_code.ogg"></audio></td></tr>
		<tr><th class='J'>J</th><td><a class='sound'>.---</a><audio src="ogg/J_morse_code.ogg"></audio></td></tr>
		<tr><th class='P'>P</th><td><a class='sound'>.--.</a><audio src="ogg/P_morse_code.ogg"></audio></td></tr>
		<tr><th>_</th><td>.-.-</td></tr>
		<tr><th class='L'>L</th><td><a class='sound'>.-..</a><audio src="ogg/L_morse_code.ogg"></audio></td></tr>
		<tr><th>_</th><td>..--</td></tr>
		<tr><th class='F'>F</th><td><a class='sound'>..-.</a><audio src="ogg/F_morse_code.ogg"></audio></td></tr>
		<tr><th class='V'>V</th><td><a class='sound'>...-</a><audio src="ogg/V_morse_code.ogg"></audio></td></tr>
		<tr><th class='H'>H</th><td><a class='sound'>....</a><audio src="ogg/H_morse_code.ogg"></audio></td></tr>
	</tbody>
	</table>
<!-- 	<table>
	<tbody>
		<tr><th class='0'>0</th><td><a class='sound'>-----</a><audio src="ogg/0_morse_code.ogg"></audio></td></tr>
		<tr><th class='9'>9</th><td><a class='sound'>----.</a><audio src="ogg/9_morse_code.ogg"></audio></td></tr>
		<tr><th>_</th><td>---.-</td></tr>
		<tr><th class='8'>8</th><td><a class='sound'>---..</a><audio src="ogg/8_morse_code.ogg"></audio></td></tr>
		<tr><th>_</th><td>--.--</td></tr>
		<tr><th>_</th><td>--.-.</td></tr>
		<tr><th>_</th><td>--..-</td></tr>
		<tr><th class='7'>7</th><td><a class='sound'>--...</a><audio src="ogg/7_morse_code.ogg"></audio></td></tr>
		<tr><th>_</th><td>-.---</td></tr>
		<tr><th>_</th><td>-.--.</td></tr>
		<tr><th>_</th><td>-.-.-</td></tr>
		<tr><th>_</th><td>-.-..</td></tr>
		<tr><th>_</th><td>-..--</td></tr>
		<tr><th>_</th><td>-..-.</td></tr>
		<tr><th>_</th><td>-...-</td></tr>
		<tr><th class='6'>6</th><td><a class='sound'>-....</a><audio src="ogg/6_morse_code.ogg"></audio></td></tr>
		<tr><th class='1'>1</th><td><a class='sound'>.----</a><audio src="ogg/1_morse_code.ogg"></audio></td></tr>
		<tr><th>_</th><td>.---.</td></tr>
		<tr><th>_</th><td>.--.-</td></tr>
		<tr><th>_</th><td>.--..</td></tr>
		<tr><th>_</th><td>.-.--</td></tr>
		<tr><th>_</th><td>.-.-.</td></tr>
		<tr><th>_</th><td>.-..-</td></tr>
		<tr><th>_</th><td>.-...</td></tr>
		<tr><th class='2'>2</th><td><a class='sound'>..---</a><audio src="ogg/2_morse_code.ogg"></audio></td></tr>
		<tr><th>_</th><td>..--.</td></tr>
		<tr><th>_</th><td>..-.-</td></tr>
		<tr><th>_</th><td>..-..</td></tr>
		<tr><th class='3'>3</th><td><a class='sound'>...--</a><audio src="ogg/3_morse_code.ogg"></audio></td></tr>
		<tr><th>_</th><td>...-.</td></tr>
		<tr><th class='4'>4</th><td><a class='sound'>....-</a><audio src="ogg/4_morse_code.ogg"></audio></td></tr>
		<tr><th class='5'>5</th><td><a class='sound'>.....</a><audio src="ogg/5_morse_code.ogg"></audio></td></tr>
	</tbody>
	</table> -->
</div>
<div id="codetree"></div>


<!-- <div class='accepts'>
	<div class='accept'></div>
	<div class='accept'></div>
	<div class='accept'></div>
	<div class='accept'></div>
	<div class='accept'></div>
</div> -->
</div>
</article>

<article id='2'>
	<div id='write'>
		<textarea id='t1' placeholder='Plain text'></textarea>
		<div class='play'>
		</div>
		<textarea id='t2' placeholder='Morse code'></textarea>
	</div>
	<div id='readout'><table><tr></tr></table></div>

</article>

<article id='3'>
<div id='game'>
	<button id='flashcard'>Start</button>
	<input type='text' id='guess' disabled>
	<button id='shuffle'>Shuffle</button>
	<div id='space'></div>
	<button id='dot'  value='.'  title='dot' >&middot;</button>
	<button id='dash' value='-' title='dash'>-</button>
</div>
</article>




<table id='all'>
<tr><th>T</th><td>-</td></tr>
<tr><th>E</th><td>.</td></tr>
<tr><th>M</th><td>--</td></tr>
<tr><th>N</th><td>-.</td></tr>
<tr><th>A</th><td>.-</td></tr>
<tr><th>I</th><td>..</td></tr>
<tr><th>O</th><td>---</td></tr>
<tr><th>G</th><td>--.</td></tr>
<tr><th>K</th><td>-.-</td></tr>
<tr><th>D</th><td>-..</td></tr>
<tr><th>W</th><td>.--</td></tr>
<tr><th>R</th><td>.-.</td></tr>
<tr><th>U</th><td>..-</td></tr>
<tr><th>S</th><td>...</td></tr>
<tr><th>_</th><td>----</td></tr>
<tr><th>_</th><td>---.</td></tr>
<tr><th>Q</th><td>--.-</td></tr>
<tr><th>Z</th><td>--..</td></tr>
<tr><th>Y</th><td>-.--</td></tr>
<tr><th>C</th><td>-.-.</td></tr>
<tr><th>X</th><td>-..-</td></tr>
<tr><th>B</th><td>-...</td></tr>
<tr><th>J</th><td>.---</td></tr>
<tr><th>P</th><td>.--.</td></tr>
<tr><th>_</th><td>.-.-</td></tr>
<tr><th>L</th><td>.-..</td></tr>
<tr><th>_</th><td>..--</td></tr>
<tr><th>F</th><td>..-.</td></tr>
<tr><th>V</th><td>...-</td></tr>
<tr><th>H</th><td>....</td></tr>
<!-- <tr><th>0</th><td>-----</td></tr>
<tr><th>9</th><td>----.</td></tr>
<tr><th>_</th><td>---.-</td></tr>
<tr><th>8</th><td>---..</td></tr>
<tr><th>_</th><td>--.--</td></tr>
<tr><th>_</th><td>--.-.</td></tr>
<tr><th>_</th><td>--..-</td></tr>
<tr><th>7</th><td>--...</td></tr>
<tr><th>_</th><td>-.---</td></tr>
<tr><th>_</th><td>-.--.</td></tr>
<tr><th>_</th><td>-.-.-</td></tr>
<tr><th>_</th><td>-.-..</td></tr>
<tr><th>_</th><td>-..--</td></tr>
<tr><th>_</th><td>-..-.</td></tr>
<tr><th>_</th><td>-...-</td></tr>
<tr><th>6</th><td>-....</td></tr>
<tr><th>1</th><td>.----</td></tr>
<tr><th>_</th><td>.---.</td></tr>
<tr><th>_</th><td>.--.-</td></tr>
<tr><th>_</th><td>.--..</td></tr>
<tr><th>_</th><td>.-.--</td></tr>
<tr><th>_</th><td>.-.-.</td></tr>
<tr><th>_</th><td>.-..-</td></tr>
<tr><th>_</th><td>.-...</td></tr>
<tr><th>2</th><td>..---</td></tr>
<tr><th>_</th><td>..--.</td></tr>
<tr><th>_</th><td>..-.-</td></tr>
<tr><th>_</th><td>..-..</td></tr>
<tr><th>3</th><td>...--</td></tr>
<tr><th>_</th><td>...-.</td></tr>
<tr><th>4</th><td>....-</td></tr>
<tr><th>5</th><td>.....</td></tr> -->
</table>

</body>
</html>